(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4849:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>et});var r=a(9944),s=a(1428),n=a(1565),l=a.n(n),i=a(592),o=a(9931),c=a(9068),d=a(2431),u=a(6534),m=a(9400);let h=e=>{let{isOpen:t,onClose:a}=e;return t?(0,r.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center",children:[(0,r.jsx)("div",{className:"fixed inset-0 transition-opacity bg-gray-900 bg-opacity-75",onClick:a}),(0,r.jsxs)("div",{className:"relative inline-block w-full max-w-2xl p-6 overflow-hidden text-left align-middle transition-all transform bg-gray-800 rounded-lg shadow-xl",children:[(0,r.jsx)("div",{className:"absolute top-4 right-4",children:(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-300 transition-colors",children:(0,r.jsx)(m.A,{className:"w-6 h-6"})})}),(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"Welcome to Moleculens"}),(0,r.jsxs)("div",{className:"space-y-4 text-gray-300",children:[(0,r.jsx)("p",{children:"Moleculens helps you learn chemistry through interactive 3D visualizations. Simply describe what you want to learn about, and we'll generate a 3D model that you can explore."}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-white mt-6",children:"How to use:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside space-y-2",children:[(0,r.jsx)("li",{children:'Type what you want to learn about (or use "Suggest Random Topic")'}),(0,r.jsx)("li",{children:'Click "Learn" to generate a 3D visualization'}),(0,r.jsxs)("li",{children:["Interact with the model:",(0,r.jsxs)("ul",{className:"list-disc list-inside ml-6 mt-1 text-gray-400",children:[(0,r.jsx)("li",{children:"Click and drag to rotate"}),(0,r.jsx)("li",{children:"Scroll to zoom in/out"}),(0,r.jsx)("li",{children:"Right-click and drag to pan"})]})]}),(0,r.jsx)("li",{children:"Use the expand button to view the model in full screen"}),(0,r.jsx)("li",{children:"Download the visualization to view it offline"})]}),(0,r.jsx)("p",{className:"mt-6",children:'Try starting with simple molecules like "water" or "methane" and work your way up to more complex structures!'})]})]})]})}):null};var p=a(2957),x=a(3881),f=a(9843),b=a(6247);function g(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,b.QP)((0,f.$)(t))}let y={HISTORY:"moleculens_history"};async function w(e){try{if(e.cid){let t=await fetch("/api/pubchem/search/cid",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cid:e.cid})});if(t.ok){let a=await t.json(),r={pdb_data:a.pdb_data||"",sdf:a.sdf_data||a.sdf||"",html:"",title:e.name||a.name};return{...e,visualization:r}}}if(e.pdbId){let t="https://files.rcsb.org/download/".concat(e.pdbId,".pdb"),a=await fetch(t);if(a.ok){let t={pdb_data:await a.text(),html:"",title:e.name||e.title};return{...e,visualization:t}}}if(e.apiParams){let t=await fetch(e.apiParams.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e.apiParams.query,model:e.apiParams.model,interactive:e.apiParams.interactive,pubchem:e.apiParams.pubchem})});if(!t.ok)throw Error("API call failed: ".concat(t.statusText));let a=await t.json();return{...e,visualization:a}}return null}catch(e){return console.error("Error recreating visualization from history:",e),null}}let v=p.bL;p.l9;let j=p.ZL;p.bm;let N=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(p.hJ,{ref:t,className:g("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});N.displayName=p.hJ.displayName;let T=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsxs)(j,{children:[(0,r.jsx)(N,{}),(0,r.jsxs)(p.UC,{ref:t,className:g("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[s,(0,r.jsxs)(p.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(x.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});T.displayName=p.UC.displayName;let k=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:g("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};k.displayName="DialogHeader";let C=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(p.hE,{ref:t,className:g("text-lg font-semibold leading-none tracking-tight",a),...s})});C.displayName=p.hE.displayName;let S=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(p.VY,{ref:t,className:g("text-sm text-muted-foreground",a),...s})});S.displayName=p.VY.displayName;var z=a(6361);let M=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(z.bL,{className:g("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border border-white/15 shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/30 focus-visible:ring-offset-2 focus-visible:ring-offset-transparent disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-white/60 data-[state=unchecked]:bg-white/10",a),...s,ref:t,children:(0,r.jsx)(z.zi,{className:g("pointer-events-none block h-4 w-4 rounded-full shadow-md ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0 bg-white")})})});M.displayName=z.bL.displayName;var E=a(2349),P=a(8811);let _=(0,P.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),R=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(E.b,{ref:t,className:g(_(),a),...s})});R.displayName=E.b.displayName;var L=a(8778);let A=(0,P.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),D=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:l=!1,...i}=e,o=l?L.DX:"button";return(0,r.jsx)(o,{className:g(A({variant:s,size:n,className:a})),ref:t,...i})});D.displayName="Button";let I=e=>{let{isOpen:t,onClose:a,alwaysFindMolecule:s,setAlwaysFindMolecule:n,isInteractive:l=!1,setIsInteractive:i}=e;return(0,r.jsx)(v,{open:t,onOpenChange:e=>!e&&a(),children:(0,r.jsxs)(T,{className:"sm:max-w-xl bg-[#0B0F1A]/80 backdrop-blur-xl border border-white/10 shadow-2xl sm:rounded-2xl p-6",children:[(0,r.jsxs)(k,{children:[(0,r.jsx)(C,{className:"text-xl font-semibold tracking-tight text-white",children:"Settings"}),(0,r.jsx)(S,{className:"text-white/60",children:"Configure your Moleculens preferences"})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-6 p-4 rounded-xl bg-white/[0.06] border border-white/10",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)(R,{className:"block text-white",children:"Molecule interaction"}),(0,r.jsx)("p",{className:"text-sm text-white/60 mt-1",children:"Enable atom hover highlighting and tooltips in the 3D viewer."})]}),(0,r.jsx)(M,{checked:l,onCheckedChange:e=>null==i?void 0:i(!!e)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-6 p-4 rounded-xl bg-white/[0.06] border border-white/10",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)(R,{className:"block text-white",children:"Always find a molecule for any request"}),(0,r.jsx)("p",{className:"text-sm text-white/60 mt-1",children:"If enabled, the app will try to find or invent a related molecule even for unrelated prompts."})]}),(0,r.jsx)(M,{checked:s,onCheckedChange:n})]}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(D,{className:"bg-[#111827]/80 hover:bg-[#1F2937]/80 text-white border border-white/15 shadow-md focus-visible:ring-2 focus-visible:ring-white/20",onClick:a,children:"Close"})})]})]})})},F=e=>{let{children:t,useConstraints:a=!0}=e;return(0,r.jsx)("div",{className:"w-full ".concat(a?"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8":""),children:t})},O=e=>{let{onOpenTimeMachine:t,onSettingsChange:a,useConstraints:n=!0}=e,[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[b,g]=(0,s.useState)(null),[y,w]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1);return(0,r.jsx)("header",{className:"bg-gradient-to-r from-blue-900 to-purple-900 text-white py-2 px-4 shadow-lg",children:(0,r.jsx)(F,{useConstraints:n,children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,r.jsx)("div",{className:"w-5 h-5 sm:w-6 sm:h-6",children:(0,r.jsx)(i.A,{className:"w-full h-full text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-lg sm:text-2xl font-bold",children:"MolecuLens"}),(0,r.jsx)("p",{className:"text-xs opacity-80 hidden sm:block",children:"Let's make science visual"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,r.jsxs)(l(),{href:"/research",className:"hidden sm:inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/20 text-white transition-colors","aria-label":"Research",children:[(0,r.jsx)(o.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Research"})]}),(0,r.jsx)("button",{onClick:()=>p(!0),className:"p-1.5 sm:p-2 text-gray-200 hover:text-white transition-colors rounded-full hover:bg-white/10","aria-label":"Help",children:(0,r.jsx)(c.A,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),(0,r.jsx)("button",{onClick:t,className:"p-1.5 sm:p-2 text-gray-200 hover:text-white transition-colors rounded-full hover:bg-white/10","aria-label":"Time Machine",children:(0,r.jsx)(d.A,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),(0,r.jsx)("button",{onClick:()=>f(!0),className:"p-1.5 sm:p-2 text-gray-200 hover:text-white transition-colors rounded-full hover:bg-white/10","aria-label":"Settings",children:(0,r.jsx)(u.A,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),(0,r.jsx)(h,{isOpen:m,onClose:()=>p(!1)}),(0,r.jsx)(I,{isOpen:x,onClose:()=>f(!1),alwaysFindMolecule:v,setAlwaysFindMolecule:e=>{j(e),a({model:b,isInteractive:y,usePubChem:!0,alwaysFindMolecule:e})},isInteractive:y,setIsInteractive:e=>{w(e),a({model:b,isInteractive:e,usePubChem:!0,alwaysFindMolecule:v})}})]})})})},H=e=>{let{useConstraints:t=!0}=e;return(0,r.jsx)("footer",{className:"bg-gray-900 text-gray-400 py-2 px-4 border-t border-gray-800",children:(0,r.jsx)(F,{useConstraints:t,children:(0,r.jsx)("div",{className:"container mx-auto text-center text-xs",children:(0,r.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," Moleculens - Molecule Visualization Platform"]})})})})},B=a(3570).env.NEXT_PUBLIC_API_BASE_URL||"/api",U=B.startsWith("http://localhost"),V=async(e,t)=>{let a="".concat(B,"/prompt/fetch-molecule-data/");try{let r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},credentials:U?"include":"same-origin",body:JSON.stringify({query:e,alwaysFindMolecule:!!(null==t?void 0:t.alwaysFindMolecule)})}),s={};try{s=await r.json()}catch(e){}if(!r.ok){let e=(null==s?void 0:s.error)?s.error:"".concat(r.status," ").concat(r.statusText);throw Error("Failed to fetch molecule data: ".concat(e))}if(s.detail)throw Error(s.detail);return s}catch(e){throw console.error("Error fetching molecule data:",e),e}},J=async e=>{let t="".concat(B,"/prompt/generate-molecule-html/");try{let a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},credentials:U?"include":"same-origin",body:JSON.stringify({molecule_data:e})});if(!a.ok)throw Error("Failed to generate HTML: ".concat(a.status," ").concat(a.statusText));let r=await a.json();if(!r.html)throw Error("No HTML returned from backend");return r}catch(e){throw console.error("Error generating HTML:",e),e}};var W=a(1961),q=a(6576),Y=a(6096);let G=["Teach me about water molecules and their 3D structure","Teach me about glucose and its 3D structure","Teach me about benzene's aromatic structure","Teach me about tetrahedral carbon geometry","Teach me about cyclohexane's chair conformations","Teach me about diborane's bridging hydrogen bonds","Teach me about boranes and 3-center 2-electron bonds","Teach me about ferrocene's sandwich structure","Teach me about cubane's unusual bond angles","Teach me about bullvalene's fluxional structure","Teach me about porphyrin rings and their coordination sites","Teach me about crown ethers' coordination geometry","Teach me about transition metal complexes with octahedral geometry","Teach me about metal-carbonyl complexes and back-bonding","Teach me about phosphazenes and their ring structures","Teach me about the metal sandwich complexes like bis(cyclopentadienyl) complexes","Teach me about cryptands and 3D host-guest complexation","Teach me about norbornane and its bridging structure","Teach me about carboranes and their polyhedral cage structures","Teach me about metal-metal quadruple bonds in dimolybdenum complexes","Teach me about PAMAM dendrimers and their hyperbranched growth patterns","Teach me about polyoxometalates and their metal-oxygen clusters","Teach me about helicenes and their helical chirality","Teach me about metallophthalocyanines and their planar macrocycles","Teach me about organosilanes and the silicon hypervalency debate","Teach me about peptidic β-sheets and α-helices in proteins","Teach me about bridging metal-carbonyl ligands in cluster compounds","Teach me about cuneane and its strained cage system","Teach me about tetraphenylporphyrin and its planar macrocycle","Teach me about the Kekul\xe9 structure of benzene","Teach me about the Woodward-Hoffmann rules for conrotatory and disrotatory reactions","Teach me about circulene and its unique ring structure"],K=e=>{let{onVisualizationUpdate:t,onLoadingChange:a,currentPrompt:n,onPromptChange:l,onPromptSubmit:i,model:o,isInteractive:c,usePubChem:d,alwaysFindMolecule:u,currentHtml:m,currentTitle:h,onInfoUpdate:p,_moleculeInfo:x}=e,[f,b]=(0,s.useState)(!1),[g,y]=(0,s.useState)(null),[w,v]=(0,s.useState)(m||null),[j,N]=(0,s.useState)(h||null),[T,k]=(0,s.useState)(null),[C,S]=(0,s.useState)(!1),[z,M]=(0,s.useState)(!1),[E,P]=(0,s.useState)(null),_=(0,s.useRef)(null),[R,L]=(0,s.useState)({isRecording:!1,audioBlob:null,isProcessing:!1,error:null,isInitialized:!1,pendingTranscription:!1}),A=(0,s.useRef)(null),D=(0,s.useRef)([]),[I,F]=(0,s.useState)(null),O=(0,s.useRef)(void 0),H=(0,s.useRef)([]),[,B]=(0,s.useState)("audio/webm");(0,s.useEffect)(()=>{(()=>{let e=_.current;if(!e)return;e.style.height="auto";let t=window.getComputedStyle(e),a=Math.max(e.scrollHeight,parseFloat(t.minHeight)||0);e.style.height="".concat(a,"px")})()},[n]),(0,s.useEffect)(()=>{m&&v(m),h&&N(h)},[m,h]),(0,s.useEffect)(()=>{let e=MediaRecorder.isTypeSupported;for(let t of["audio/webm","audio/mp4","audio/ogg","audio/wav"])if(e(t))return void B(t);B("audio/webm")},[]);let U=(0,s.useCallback)(()=>{0===H.current.length&&(H.current=Array(8).fill(50));let e=new Uint8Array(8),t=Date.now()/1e3,a=.5*Math.sin(1.5*t)+.5>.7;for(let r=0;r<8;r++){let s,n=.5*Math.sin(2*t+Math.PI/4*r)+.5;s=a?70+120*n+20*Math.sin(10*t+r):40+70*n+10*Math.sin(5*t+r);let l=H.current[r]||50,i=l+(s-l)*.15;H.current[r]=i,e[r]=Math.max(30,Math.min(255,i))}F(e),O.current=requestAnimationFrame(U)},[]);(0,s.useEffect)(()=>()=>{O.current&&cancelAnimationFrame(O.current)},[]);let K=async()=>{try{var e,t;if(!R.isInitialized){let e,t=await navigator.mediaDevices.getUserMedia({audio:!0}),a="audio/webm";F(new Uint8Array(8).fill(40));try{e=new MediaRecorder(t,{mimeType:a})}catch(a){e=new MediaRecorder(t)}e.ondataavailable=e=>{e.data.size>0&&D.current.push(e.data)},e.onstop=()=>{if(0===D.current.length)return void L(e=>({...e,isRecording:!1,error:"No audio data recorded",isProcessing:!1,pendingTranscription:!1}));let e=new Blob(D.current,{type:a});F(null),H.current=[],O.current&&cancelAnimationFrame(O.current),D.current=[],L(t=>(t.pendingTranscription&&setTimeout(()=>X(e),0),{...t,audioBlob:e,isRecording:!1,isProcessing:t.pendingTranscription}))},A.current=e,L(e=>({...e,isInitialized:!0}))}R.isRecording?(null==(t=A.current)||t.stop(),L(e=>({...e,isRecording:!1})),O.current&&cancelAnimationFrame(O.current)):(D.current=[],null==(e=A.current)||e.start(100),L(e=>({...e,isRecording:!0,audioBlob:null,error:null})),O.current=requestAnimationFrame(U))}catch(e){L(e=>({...e,error:"Failed to access microphone. Please check permissions.",isRecording:!1}))}},X=async e=>{let t,a=e||R.audioBlob;if(!a)return void L(e=>({...e,isProcessing:!1,error:"No audio data available",pendingTranscription:!1}));L(e=>({...e,isProcessing:!0,error:null}));try{let e=new FileReader,r=new Promise((r,s)=>{let i=!1;e.onload=async()=>{try{let s,o=e.result,c=a.type||"audio/webm",d=await fetch("/api/transcribe",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({audio:o,mimeType:c})});if(!d.ok){let e=await d.text();throw Error("API error: ".concat(d.status," ").concat(e))}let u=await d.text();try{s=JSON.parse(u)}catch(e){throw Error("Invalid response format from server")}if(s.error)throw Error(s.error);if(!i){i=!0,clearTimeout(t);let e=s.text.trim(),a=n.trim(),o=a?"".concat(a," ").concat(e):e;l(o),L({isRecording:!1,audioBlob:null,isProcessing:!1,error:null,isInitialized:!0,pendingTranscription:!1}),r(s)}}catch(e){i||(i=!0,clearTimeout(t),s(e))}},e.onerror=()=>{i||(i=!0,clearTimeout(t),s(Error("Failed to read audio file")))}});e.readAsDataURL(a);let s=new Promise((e,a)=>{t=setTimeout(()=>{a(Error("Transcription timed out"))},3e4)});await Promise.race([r,s])}catch(e){L(t=>({...t,isProcessing:!1,error:e instanceof Error?e.message:"Failed to transcribe audio",pendingTranscription:!1}))}finally{clearTimeout(t)}},Z=async e=>{if(e.preventDefault(),n.trim()&&!f){b(!0),a(!0),k(null),S(!1),N(null);try{let e=await V(n,{alwaysFindMolecule:!!u}),r=e.pdb_data,s=e.sdf,l=r||s;if(l){let o=e.name,c=e.info;P(e),y(l),N(o),t(r||"",void 0,null!=o?o:void 0,s,e.moleculeType||"small molecule"),p&&p(c);let d={pdb_data:l,html:"",title:o,moleculeType:e.moleculeType||"small molecule",cid:e.cid,name:o,info:c,...e.pdb_id?{pdb_id:e.pdb_id}:{}};s&&(d.sdf=s),i(n,d),b(!1),a(!1)}else throw Error("No molecule data received from API")}catch(e){b(!1),a(!1),e instanceof Error&&e.message.includes("Non-molecular prompt")?(S(!0),k('Your prompt should be related to molecular structures. Click on the "Suggest Molecule" button to get started.')):k(e instanceof Error?e.message:"Failed to process prompt")}}};return(0,r.jsxs)("div",{className:"flex flex-col gap-4 p-4 sm:p-6 bg-gradient-to-b from-gray-800 to-gray-900 rounded-xl shadow-xl border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1 mb-1",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Molecular Structure Visualization"}),(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm",children:"Enter a molecular topic or structure to generate an interactive 3D visualization."})]}),(0,r.jsxs)("form",{onSubmit:Z,className:"flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("textarea",{ref:_,value:n,onChange:e=>{l(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),!f&&n.trim()&&Z(e))},placeholder:"Enter your prompt about molecular structures...",className:"w-full min-h-[7rem] py-4 px-4 pb-20 text-gray-100 bg-gray-700/50 rounded-lg border border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/30 placeholder-gray-500 transition-all duration-200 ease-in-out hover:border-gray-500 overflow-hidden leading-relaxed",style:{resize:"none"},rows:1,disabled:f,maxLength:500,"aria-label":"Molecular structure prompt input"}),(0,r.jsx)("div",{className:"absolute inset-x-0 bottom-0 min-h-[3.5rem] px-3 flex items-center justify-end gap-2",children:(0,r.jsxs)("div",{className:"relative flex items-center gap-2 min-h-[3.5rem] w-full",children:[R.isRecording&&(0,r.jsxs)("div",{className:"absolute right-0 flex items-center h-8  bg-blue-500/20 border border-blue-500/30 rounded-full px-6 audio-recording transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)]",children:[(0,r.jsx)("div",{className:"flex items-center justify-center gap-[3px] h-full min-w-[60px]",children:I?Array.from({length:10}).map((e,t)=>{let a=I[t%8]||0;return(0,r.jsx)("div",{className:"w-[3px] bg-blue-400 rounded-full audio-bar",style:{height:"".concat(Math.max(20,Math.min(65,20+45*Math.pow(a/255,.25))),"%"),transform:"scaleY(".concat(1+a/512,")"),opacity:.7+a/512,backgroundColor:a>150?"#3b82f6":"#60a5fa"}},t)}):Array.from({length:10}).map((e,t)=>(0,r.jsx)("div",{className:"w-[3px] bg-blue-400 rounded-full animate-[audio-wave_1s_ease-in-out_infinite_alternate]",style:{height:"35%",animationDelay:"".concat(.05*t,"s")}},t))}),(0,r.jsxs)("div",{className:"flex items-center gap-1 ml-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{L(e=>({...e,pendingTranscription:!0})),setTimeout(()=>{var e;null==(e=A.current)||e.stop()},0)},className:"h-6 w-6 flex items-center justify-center rounded-full  bg-blue-500/50 hover:bg-blue-500/70 text-white transition-all duration-200",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,r.jsx)("button",{type:"button",onClick:()=>{A.current&&R.isRecording&&A.current.stop(),H.current=[],L(e=>({...e,isRecording:!1,audioBlob:null,isProcessing:!1,error:null,pendingTranscription:!1}))},className:"h-6 w-6 flex items-center justify-center rounded-full  bg-blue-500/30 hover:bg-blue-500/50 text-white transition-all duration-200",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 ".concat(n.trim()?"mr-0":"-mr-2"," transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)]\n                                ").concat(R.isRecording?"opacity-0 translate-x-2 pointer-events-none":"opacity-100 translate-x-0"),children:[(0,r.jsx)("div",{className:"relative flex items-center justify-center",onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1),children:(0,r.jsx)("button",{type:"button",onClick:()=>{l(G[Math.floor(Math.random()*G.length)]),S(!1),k(null),_.current&&_.current.focus()},className:"transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)] flex items-center justify-center\n                                  h-8 rounded-md bg-transparent hover:bg-gray-600/40 text-blue-400\n                                  focus:outline-none focus:ring-1 focus:ring-blue-500/50\n                                  ".concat(z?"px-3":"px-1.5"),"aria-label":"Suggest molecule",disabled:f,children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 flex-shrink-0",children:(0,r.jsx)("path",{d:"M10 16.584V18.9996C10 20.1042 10.8954 20.9996 12 20.9996C13.1046 20.9996 14 20.1042 14 18.9996L14 16.584M12 3V4M18.3643 5.63574L17.6572 6.34285M5.63574 5.63574L6.34285 6.34285M4 12H3M21 12H20M17 12C17 14.7614 14.7614 17 12 17C9.23858 17 7 14.7614 7 12C7 9.23858 9.23858 7 12 7C14.7614 7 17 9.23858 17 12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,r.jsx)("div",{className:"overflow-hidden transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)]\n                                      ".concat(z?"w-16 opacity-100 ml-2":"w-0 opacity-0 ml-0"),children:(0,r.jsx)("span",{className:"whitespace-nowrap font-medium",children:"Suggest"})})]})})}),!R.isProcessing&&(0,r.jsx)("button",{type:"button",onClick:K,className:"h-8 w-8 flex items-center justify-center rounded-md  bg-transparent hover:bg-gray-600/40 text-gray-400 transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)]","aria-label":"Start voice input",children:(0,r.jsx)(W.A,{className:"w-5 h-5"})}),R.isProcessing&&(0,r.jsx)("div",{className:"h-8 w-8 flex items-center justify-center",children:(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 text-blue-400",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),(0,r.jsx)("div",{className:"flex items-center transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)]\n                                ".concat(!n.trim()||f||R.isRecording?"w-0 opacity-0 transform -translate-x-1 scale-90":"w-8 opacity-100 transform translate-x-0 scale-100"),children:(0,r.jsx)("button",{type:"submit",className:"h-8 w-8 flex items-center justify-center rounded-md bg-blue-500 hover:bg-blue-400  text-white transition-colors duration-200","aria-label":"Generate visualization",disabled:!n.trim()||f||R.isRecording,children:(0,r.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M12 20V4M12 4L6 10M12 4L18 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})})]})]})})]}),f&&(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 py-2 text-blue-400 text-sm",children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("span",{children:"Generating visualization..."})]}),T&&(0,r.jsx)("div",{className:"transform transition-all duration-200 ease-in-out\n                           ".concat(C?"bg-yellow-500/10":"bg-red-500/10"," \n                           rounded-lg p-3"),children:(0,r.jsxs)("div",{className:"text-xs sm:text-sm ".concat(C?"text-yellow-400":"text-red-400"," \n                             flex items-start gap-2"),children:[(0,r.jsx)(q.A,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("p",{className:"break-words",children:T})})]})})]}),(g||w)&&!f&&("undefined"!=typeof navigator&&/android|iphone|ipad|mobile/i.test(navigator.userAgent.toLowerCase())?null:g&&!w?(0,r.jsx)("button",{type:"button",onClick:async()=>{try{if(!E)throw Error("No molecule data to generate HTML");b(!0),a(!0);let e=(await J(E)).html;v(e),t(g,null!=e?e:void 0,null!=j?j:void 0),b(!1),a(!1)}catch(e){b(!1),a(!1),k(e instanceof Error?e.message:"Failed to generate presentation")}},className:"self-end flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white text-sm font-medium shadow-md shadow-blue-500/20 transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:"Generate Presentation"}):w?(0,r.jsxs)("button",{type:"button",onClick:()=>{if(!g&&!w)return;let e=(j||"visualization").replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"_").substring(0,100),t=new Blob([w||""],{type:"text/html"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="".concat(e,".html"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},className:"self-end flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white text-sm font-medium shadow-md shadow-green-500/20 transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-500/50","aria-label":"Download visualization",children:[(0,r.jsx)(Y.A,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Download"})]}):null),R.isProcessing&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-500 mt-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500 animate-pulse"}),(0,r.jsx)("span",{children:"Converting speech to text..."})]})]})]})};var X=a(1578),Z=a(6815);let Q=e=>{let{isOpen:t,onClose:a,history:n,onSelectEntry:l}=e,i=(0,s.useRef)(null);return((0,s.useEffect)(()=>{function e(e){i.current&&!i.current.contains(e.target)&&a()}if(t)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[t,a]),t)?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30",role:"dialog","aria-modal":"true","aria-labelledby":"time-machine-title",children:(0,r.jsx)("div",{ref:i,className:"fixed right-0 top-0 h-full w-full sm:w-80 bg-gray-800 shadow-xl z-40 transform transition-transform duration-300 ease-in-out","aria-describedby":"time-machine-description",children:(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-white",children:[(0,r.jsx)(d.A,{className:"w-5 h-5"}),(0,r.jsx)("h2",{id:"time-machine-title",className:"text-lg font-semibold",children:"Time Machine"})]}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-300 transition-colors","aria-label":"Close time machine",children:(0,r.jsx)(m.A,{className:"w-6 h-6"})})]}),(0,r.jsx)("div",{id:"time-machine-description",className:"sr-only",children:"View and restore previous molecule visualizations from your history"}),(0,r.jsx)("div",{className:"flex-grow overflow-y-auto p-4",children:0===n.length?(0,r.jsx)("div",{className:"text-gray-400 text-center mt-4",children:"No history yet. Start learning!"}):(0,r.jsx)("div",{className:"space-y-3",children:n.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>l(e),className:"w-full text-left p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors group","aria-label":"Restore visualization from ".concat(e.timestamp.toLocaleString()),children:[(0,r.jsx)("p",{className:"text-white line-clamp-2 group-hover:text-blue-300 transition-colors",children:e.prompt}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsx)("p",{className:"text-xs text-gray-400",children:e.timestamp.toLocaleString()}),e.visualization&&(0,r.jsx)("span",{className:"text-xs bg-blue-500/20 text-blue-300 px-2 py-0.5 rounded",children:"Saved"})]})]},t))})})]})})}):null};async function $(){try{let e=await fetch("/sample-molecules.json");if(!e.ok)throw Error("Failed to fetch sample molecules: ".concat(e.statusText));return await e.json()}catch(e){return console.error("Error loading sample molecules:",e),null}}let ee=(0,Z.default)(()=>a.e(972).then(a.bind(a,7972)),{loadableGenerated:{webpack:()=>[7972]},ssr:!1});function et(){let[e,t]=(0,s.useState)(null),[a,n]=(0,s.useState)(null),[l,i]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(!0),[p,x]=(0,s.useState)(""),[f,b]=(0,s.useState)(null),[g,v]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[T,k]=(0,s.useState)([]),[C,S]=(0,s.useState)(!1),[z,M]=(0,s.useState)(null),[E,P]=(0,s.useState)(void 0),[_]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(m&&o&&("macromolecule"===E?!!e:!!(a||e))){let e=setTimeout(()=>{h(!1)},800);return()=>clearTimeout(e)}},[m,o,e,a,E]),(0,s.useEffect)(()=>{let e=!1;return(async()=>{h(!0);try{var a;let r=await $();if(!r)return;let s=function(e){let t=e.defaultMolecule;return e.molecules[t]||null}(r)||r.molecules.caffeine||null;if(!s||e)return;t(s.pdbData||null),n(s.sdfData||null),c(s.name),P(s.type),M(s.moleculeInfo);let l=!!(s.sdfData&&s.sdfData.trim().length>0),i=!!(s.pdbData&&s.pdbData.trim().length>0),o=(null==(a=s.apiSource)?void 0:a.query)||s.name;l&&i||!o||V(o).then(a=>{!e&&a&&(t(a.pdb_data&&a.pdb_data.trim().length>0?a.pdb_data:s.pdbData||null),n(a.sdf&&a.sdf.trim().length>0?a.sdf:s.sdfData||null),c(a.name||s.name),P(a.moleculeType||s.type),M(a.info||s.moleculeInfo))}).catch(e=>{})}catch(e){console.error("Failed to load default sample molecule:",e)}finally{}})(),()=>{e=!0}},[]),(0,s.useEffect)(()=>{k(function(){try{let e=sessionStorage.getItem(y.HISTORY);if(!e)return[];return JSON.parse(e,(e,t)=>t&&"object"==typeof t&&"Date"===t.__type?new Date(t.value):t)}catch(e){return console.error("Error loading history from session storage:",e),[]}}())},[]),(0,s.useEffect)(()=>{try{let e=T.map(e=>({prompt:e.prompt,timestamp:e.timestamp,title:e.title,apiParams:e.apiParams,moleculeType:e.moleculeType,name:e.name,cid:e.cid,pdbId:e.pdbId,info:e.info,visualization:e.visualization?{title:e.visualization.title,timecode_markers:e.visualization.timecode_markers,total_elements:e.visualization.total_elements,html:e.visualization.html.length>1e4?"[Large HTML excluded]":e.visualization.html}:void 0})),t=JSON.stringify(e,(e,t)=>"timestamp"===e&&t instanceof Date?{__type:"Date",value:t.toISOString()}:t);sessionStorage.setItem(y.HISTORY,t)}catch(e){console.error("Error saving history to session storage:",e)}},[T]);let R=async e=>{var a,r;S(!1),x(e.prompt),u(!0);try{let r=await w(e);if(null==r?void 0:r.visualization){let a=r.visualization;n(a.sdf||null),t(a.pdb_data||""),i(""),c(e.name||a.title||e.title||null),e.moleculeType&&P(e.moleculeType),e.info&&M(e.info),u(!1);return}e.visualization&&(n(e.visualization.sdf||null),t(e.visualization.pdb_data),i(""),c(e.name||(null!=(a=e.visualization.title)?a:null)),e.moleculeType&&P(e.moleculeType),e.info&&M(e.info))}catch(a){console.error("Failed to recreate visualization:",a),e.visualization&&(n(e.visualization.sdf||null),t(e.visualization.pdb_data),i(""),c(e.name||(null!=(r=e.visualization.title)?r:null)),e.moleculeType&&P(e.moleculeType),e.info&&M(e.info))}finally{u(!1)}};return(0,r.jsxs)("div",{className:"app-container",children:[(0,r.jsx)(O,{onOpenTimeMachine:()=>S(!0),onSettingsChange:e=>{let{model:t,isInteractive:a,alwaysFindMolecule:r}=e;b(t),v(a),N(r)},useConstraints:!0}),(0,r.jsx)("main",{className:"main-content",children:(0,r.jsx)(F,{useConstraints:!0,children:(0,r.jsxs)("div",{className:"panels-container",children:[(0,r.jsx)("div",{className:"input-panel-container",children:(0,r.jsx)(K,{onVisualizationUpdate:(e,a,r,s,l)=>{t(e),P(l),s&&s.trim().length>0?n(s):n(null),i(null!=a?a:null),c(null!=r?r:null)},onLoadingChange:e=>{u(e),e&&(c(null),t(null),n(null),M(null),h(!0))},currentPrompt:p,onPromptChange:x,onPromptSubmit:(e,t)=>{let a={prompt:e,timestamp:new Date,...t&&{visualization:t},...(null==t?void 0:t.title)&&{title:t.title},...(null==t?void 0:t.moleculeType)&&{moleculeType:t.moleculeType},...(null==t?void 0:t.name)&&{name:t.name},..."number"==typeof(null==t?void 0:t.cid)&&{cid:t.cid},...(null==t?void 0:t.pdb_id)&&{pdbId:t.pdb_id},...(null==t?void 0:t.info)&&{info:t.info},apiParams:{endpoint:"/api/prompt/fetch-molecule-data",query:e,...f&&{model:f},interactive:g,pubchem:!0}};k(e=>[a,...e])},model:f,isInteractive:g,usePubChem:!0,alwaysFindMolecule:j,...l&&{currentHtml:l},...o&&{currentTitle:o},onInfoUpdate:e=>M(e),...z&&{_moleculeInfo:z}})}),(0,r.jsxs)("div",{className:"molecule-viewer-container",children:[m&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900/50 backdrop-blur-sm z-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-400 border-t-transparent"})}),("macromolecule"===E?!!e:!!(a||e))&&o&&("macromolecule"===E?(0,r.jsx)(ee,{pdbData:e||"",title:o||""},_):(0,r.jsx)(X.A,{isLoading:d,pdbData:e||"",...a&&{sdfData:a},title:o||"",...z&&{moleculeInfo:z},...E&&{moleculeType:E},enableRibbonOverlay:!1,enableHoverPause:!1,enableHoverGlow:!1,showHoverDebug:!1,showDebugWireframe:!1},_))]})]})})}),(0,r.jsx)(H,{}),(0,r.jsx)(Q,{isOpen:C,onClose:()=>S(!1),history:T,onSelectEntry:R})]})}},9578:(e,t,a)=>{Promise.resolve().then(a.bind(a,4849))}},e=>{e.O(0,[641,407,565,205,578,695,274,358],()=>e(e.s=9578)),_N_E=e.O()}]);